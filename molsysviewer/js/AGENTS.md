# AGENTS.md — JavaScript/TypeScript area for MolSysViewer

This document is for **automation agents** (Copilot, Codeium, ChatGPT, GitHub PR bots, etc.) and for future maintainers.

Its goal is to avoid accidental edits of generated files and to prevent unnecessary build suggestions.

---

## 1. Source of truth

The **real source code** for the MolSysViewer frontend lives here:

```
js/src/*.ts
```

The TypeScript files define:

- the widget entry point (`widget.ts`)
- all Mol* integration logic
- all message handlers and shape management

Agents **may safely edit, refactor, or improve** these files.

---

## 2. Generated artifacts (DO NOT EDIT)

These files are **generated automatically** from TypeScript:

```
molsysviewer/viewer.js
molsysviewer/viewer.js.map
```

They include the header (in `viewer.js`):

```js
// @generated
// DO NOT EDIT THIS FILE BY HAND.
```

Agents must respect this rule:

> **NEVER modify viewer.js or viewer.js.map directly.  
> ONLY modify TypeScript files and let the maintainer rebuild when appropriate.**

No PR should manually propose edits to the generated JS.

---

## 3. About “npm run build”

Many automation agents assume that a TypeScript project requires rebuilding after every edit.  
**This is NOT the case in MolSysViewer.**

### ❗ IMPORTANT RULE FOR AGENTS

> **Do NOT automatically suggest running `npm run build`.**

The build step is **manual** and is only run by maintainers when regenerating the stable artifact distributed with the Python package.

### Why?

- The Python package needs a prebuilt JS file to avoid requiring Node.js on user machines.
- Rebuilding is not required for tests or CI (currently).
- The rebuild impacts the versioned artifact `viewer.js` and produces noisy diffs.

### Agents should therefore:

- Suggest changes **only** in `js/src/*.ts`.
- NOT request or propose “run npm run build”.
- NOT require build steps for validations or tests.
- Assume that build is maintainers-only.

---

## 4. Node modules and toolchain

- `node_modules/` is intentionally ignored.
- Only `package.json` (and optionally `package-lock.json`) define dependencies.
- Do not propose to commit `node_modules/`.

---

## 5. Coordination with the Python side

Do NOT change:

- `--outfile=../viewer.js`
- module format (`esm`)
- widget entry structure

without also updating the Python widget and verifying end-to-end behavior.

---

## 6. Summary for agents

- **Edit**: `js/src/*.ts`
- **Do NOT edit**: `molsysviewer/viewer.js`
- **Do NOT suggest**: `npm run build`
- **Ignore**: `node_modules/`
- **Build happens manually** only when the maintainer decides.

> MolSysViewer uses a hybrid distribution model: TypeScript is the source of truth,  
> but the Python package ships precompiled JS.  
> Agents should respect this workflow.
