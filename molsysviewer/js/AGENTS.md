# AGENTS.md — JavaScript/TypeScript area for MolSysViewer

This document is for **automation agents** (Copilot, Codeium, ChatGPT, etc.) and future maintainers working in the `js/` directory of MolSysViewer.

Its goal is to avoid accidental changes to generated files and to keep the JS/TS toolchain aligned with the Python package.

---

## 1. Directory layout (JS side)

Within this directory (`molsysviewer/js`):

- `src/`
  - TypeScript sources for the frontend:
    - `widget.ts` (entry point, anywidget + Mol* glue code)
    - other helper files as needed
- `package.json`
  - JS/TS toolchain definition (esbuild, TypeScript, Mol*)
  - **Build script**: generates the JavaScript bundle used by the Python package

The build command currently is:

```jsonc
"build": "npx esbuild src/widget.ts \
  --bundle \
  --format=esm \
  --sourcemap \
  --outfile=../viewer.js \
  --banner:js=\"// @generated\\n// This file is generated from js/src/widget.ts and related TS sources.\\n// DO NOT EDIT THIS FILE BY HAND.\\n\""
````

> **Important**: The output path is `../viewer.js`, i.e. `molsysviewer/viewer.js` at the Python package level.

---

## 2. Generated artifacts (DO NOT EDIT)

The following files are **generated** and are treated as build artifacts:

* `../viewer.js` → `molsysviewer/viewer.js`
* `../viewer.js.map` → `molsysviewer/viewer.js.map` (if/when produced)

These files:

* Are **generated by esbuild** from `js/src/widget.ts` and related TS sources.

* Are marked with a header:

  ```js
  // @generated
  // This file is generated from js/src/widget.ts and related TS sources.
  // DO NOT EDIT THIS FILE BY HAND.
  ```

* May still appear in `git diff` or PRs, but:

  * Any changes should come from **re-running the build** (`npm run build`), not from manual edits.
  * Reviewers should treat them as **opaque artifacts**.

> **RULE:** If you want to change the behavior of the viewer, edit TypeScript files in `js/src/` and then run `npm run build`. Do **not** modify `viewer.js` directly.

---

## 3. Node modules and tooling

* `node_modules/` is **not** tracked in git and **must remain ignored**.
* Only `package.json` and (if added) `package-lock.json` are the source of truth for JS dependencies.
* If you add or update a dependency:

  1. Edit `package.json` (and `package-lock.json` if present).
  2. Run `npm install`.
  3. Run `npm run build` to refresh `viewer.js`.

> **RULE:** Never commit `node_modules/` or other large build caches.

---

## 4. Coordination with the Python package

The Python package (`molsysviewer/`) expects:

* The compiled bundle at:
  `molsysviewer/viewer.js`

If you change:

* The **output path** in the build script, or
* The **module format** (`--format`), or
* The **entry point** structure,

you **must** also update the Python side accordingly (e.g. `MolSysViewerWidget` or anywidget configuration).

> **RULE:** Do not change the `--outfile=../viewer.js` location or the module format unless you also update the Python code and verify end-to-end that `MolSysView().show()` still works.

---

## 5. Tasks agents are encouraged to do

Automation agents **may**:

* Refactor TypeScript sources under `js/src/` (with care).
* Improve typings, modularization, and internal APIs in `js/src/`.
* Adjust or extend the build script in `package.json` (keeping the same output path unless coordinated).
* Add small utility scripts (e.g. `npm run lint`, `npm run check`) if helpful.

After such changes, agents should:

1. Run (or propose running) `npm run build`.
2. Accept the resulting changes in `../viewer.js` as **generated output**.

---

## 6. Tasks agents should NOT do

Automation agents **must NOT**:

* Edit `molsysviewer/viewer.js` or `molsysviewer/viewer.js.map` by hand.
* Commit `node_modules/` or any other dependency cache.
* Move or rename `viewer.js` without also updating the Python package.
* Remove or alter the `// @generated` header at the top of `viewer.js`.

If a PR or suggestion touches `viewer.js`, reviewers should check:

* Whether it comes from a legitimate `npm run build`.
* Or whether it is a manual/agent edit (in which case it should be reverted).

---

## 7. Summary (for quick readers and agents)

* **Edit:** `js/src/*.ts`
* **Build:** `cd js && npm run build`
* **Generated:** `molsysviewer/viewer.js` (do not edit)
* **Ignored:** `node_modules/`
* **Keep in sync:** build output path ↔ Python widget loading logic

